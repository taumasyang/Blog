---
title: 「你帮我助」软件开发
date: 2022-12-23 23:45:00
updated: 2023-01-19 22:11:10
categories: 软件工程
tags: 
  - Python
  - HTML
---

本项目是上海交通大学 CS-3331 软件工程课程大作业，同时也是 [Help-Goods](https://github.com/tau-young/Help-Goods) 项目的 GUI 版本，但是经过了完全的重构。

原项目采用 CLI 形式，由 Python Script 写成，理论上只要安装了 Python 3.y 解释器的机器就能运行。本项目使用 Django 制作成网页应用，因此在任何浏览器上都能访问。然而，运行本项目的服务器仍需要安装 Python 3.y 并正确部署。

# 作业描述

[原始页面](https://oc.sjtu.edu.cn/courses/48894/assignments/193007)（仅限该课程参与人员有权访问）

> ## “你帮我助”软件开发（Final）
>
> ### 新的功能需求：
>
> 1. 物品有公共的信息（物品名称，物品说明，物品所在地址，联系人手机，邮箱）。为了便于管理和查询，物品可以分成不同的类别（例如食品、书籍、工具等），不同类别的物品可能有不同的属性（例如食品有保质期，数量；书籍有作者，出版社等）。
> 2. 互帮互助系统有两种类型的用户：管理员和普通用户。
> - 管理员可以设置新的物品类型（定义物品类型的名称和各个属性），修改物品类型。
> - 普通用户在添加物品时先选择物品类型，然后再填入物品信息。普通用户搜寻物品时，需要先选择类型，再输入关键字，关键字可以再用户名称和说明中进行匹配。
> 普通用户需要注册（填入基本信息，包括住址，联系方式等），管理员批准后才能成为正式用户。
>
> 3. 为了便于使用上述功能，软件需要提供 GUI。
>
> ### 文档需求：
>
> 1. 需要提供一个文档：其中包括（1）用例模型；（2）针对用例画顺序图；（3）类图。
>
> ### 作业完成要求：
>
> 作业需要在 16 周前提交，并发布在你的 GitHub 仓库中；
> 作业完成后需要进行演示，请提前一周与助教约好。（每周周二下午都可以约）；演示的内容包括写的文档、软件的功能（包括第一次，第二次功能）。
> 在技术博客上写一篇总结文章，对照软件工程的知识，对开发该程序的体会进行总结。

# 使用说明

本仓库不包含任何测试用数据以及项目开发缓存，所有数据需要自己生成。

安装 Django
```sh
pip install django
```
克隆本仓库
```sh
git clone https://github.com/tauyoungsama/HelpGoodsWeb.git
```
切换到根目录
```sh
cd HelpGoodsWeb
```
注册迁移项
```sh
python manage.py makemigrations
python manage.py migrate
```
创建超级用户（如果需要访问后台管理页面）
```sh
python manage.py createsuperuser
```
启动服务器
```sh
python manage.py runserver
```
在浏览器中访问 <localhost:8000/user>。

# UML 图

## 用例图

![Use Case](usecase.svg)

## 顺序图

![Sequence Register](sequence-register.svg)
![Sequence Login](sequence-login.svg)
![Sequence Logout](sequence-logout.svg)
![Sequence View User Info](sequence-viewuserinfo.svg)
![Sequence View Item List](sequence-viewitemlist.svg)
![Sequence View Item Info](sequence-viewiteminfo.svg)
![Sequence Post New Item](sequence-postnewitem.svg)
![Sequence Modify Item](sequence-modifyitem.svg)
![Sequence Grant User](sequence-grantuser.svg)
![Sequence Set New Item Type](sequence-setnewitemtype.svg)

## 类图

![Class Graph](class.svg)

# 开发体会

这个项目的前身 [Help-Goods](https://github.com/tau-young/Help-Goods) 是我比较满意的一个作品，功能并不复杂，使用命令行的方式不仅简洁而且方便。作业截止后出于个人兴趣我还加强了它的功能和易用性。只可惜第二次强制要求 GUI 界面，美其名曰「为了便于使用上述功能」。若少了这条限制，我本可以将命令行程序做的不比图形界面麻烦。所以……冲着这个图形界面的要求，这个项目被我拖了将近半个学期，期间还推倒重来了若干次。

## 开发框架的选择

最开始的问题是，我要用什么框架开发这个图形界面应用程序？最开始想到的就是经典的 Python Tkinter，不仅繁琐还不好调试，曾经用过这个包的我是绝对不想再次尝试的。

如果用 C++ 可以考虑 Visual Studio，初中阶段我还真尝试过用 VS 写了一个简单的加密/解密小程序，并且头一次惊叹居然一个图形界面程序可以只有 10KB 大小。当然后来想明白 VS 开发的这个程序肯定用了 .NET 运行库，毕竟 gcc 编译的命令行程序动辄上兆呢。

或者是，用 Qt 框架开发，我就可以让我的程序编写一次就能在所有平台上运行，这绝对是非常吸引人的。然而，我对 Qt 陌生到甚至连第一个项目都建立不起来，这接下去还玩什么呢。

要在 macOS 上开发程序，近年来的新晋选手必属 SwiftUI 了。苹果公司出品的程序设计语言 Swift 搭配苹果公司出品的图形框架 SwiftUI，在苹果公司出品的机器上运行，兼容性问题什么的都不用担心哒！事实上，我一开始确实决定使用 SwiftUI 开发这个项目，View 文件都已经写了一堆了。不过令人惊奇的是，我本打算将程序入口放在登录界面，由这个界面跳转到其他界面，而 SwiftUI 无法做到这一点。那段时间，我为了寻找类似的项目在互联网上茫茫搜索了半个月都没找到解决方案。这就是 SwiftUI 的缺点所在——出生四年，年年更新，SwiftUI 2.0 引入的新功能在 SwiftUI 4.0 被弃用，网上找的永远是过时的。而数据存储的 CoreData 模块甚至在开始学之前就令人劝退。我觉得，我是没办法在半个学期之内学完我需要的 SwiftUI 知识并成功开发出这个项目的。

最后，或许是无意中的发现，Django 成了我的最终选择。这是一个将 Python 作为网站后台的开发包。后端由 Python 负责处理网站请求，前端只需编写少量 HTML 即可。这样一来，可操作性就大了不少，而且可以应用 PyPI 上数千万开源包，也不用受各种未实现的气。

## 开发过程

软件过程模型总体上来说符合**增量模型**。项目分为三个子模块，分别是负责用户登录和注册的 `user` 模块、用于展示和操作物品的 `item` 模块，以及管理员批准用户和增加类型的 `staff` 模块。前端页面使用的是纯 HTML，采用了一点点 CSS，用于给表格加上边框。所以页面看上去并不美观，但是功能绝对不欠缺。

### `user` 模块

登录页面相当于整个网站的入口，未登录的用户访问其他不该访问的页面时，都会被重定向到登录页面。包含登录和注册在内的诸多信息收集页面都采用了 Django Forms，方便了处理用户输入的步骤。第一个注册的用户将直接激活并被提拔为管理员。

用户模型分为两部分，一是 `django.auth` 模块提供的 `User` 模型，有它可以方便地进行登录、登出、检查用户等一系列认证操作，并可安全地储存用户的密码；二是自己建立的 `User` 模型，用于储存用户的其他信息，便于在其他模块调用。

在用户详细信息界面，电话号码和电子邮件地址被设置了超链接，直接点击可以拨打或发送电子邮件。未激活的用户将看到「禁止访问其他页面」的警告，正式用户将看到一个指向物品页面的超链接，管理员有一个指向管理页面的超链接。

### `item` 模块

这个模块的主页面在一张 `<table>` 中展示了所有物品的信息，并且每个类型都有各自的页面，可以更详细地显示该类型专属的物品属性。用户可以添加物品、修改或删除自己添加的物品，管理员可以删除其他人的物品。

物品模型包括基类 `Base` 和派生类 `Item`，前者存有所有物品的共有属性信息，后者存有每个类型专属的属性信息。附加信息由管理员指定，无法提前硬编码在程序中，因此采用了 `JSON` 字符串的形式存在数据库中。

添加或编辑物品时，将由当前用户的信息自动填充部分表单，用户至少只需要填写物品名称和描述就可以完成一个物品的添加或编辑。当然，联系信息也可以修改成与当前用户信息不同的内容。

### `staff` 模块

当有用户注册未审核时，管理员页面将会出现这些用户的信息。批准一个用户时，该用户的 `is_active` 属性被设置成 `True`；拒绝一个用户时，该用户的信息将被直接删除。当所有未审核用户都处理完成时，包含标题在内的审核部分将从主页面上完全消失。

主页面的下半部分列出了所有物品类型。当启动一个新项目时，类型默认为空，因此需要管理员新建一个默认类型。

动态表单是一个比较复杂的实现，~~偷懒~~方便起见，附加属性采用了超大号的输入框，用换行分隔不同的属性。

### `admin` 模块

Django 提供了超级管理员的后台界面。如有需要，可以在超级后台管理用户状态、数据库中的物品信息。如果需要使用超级后台，需要用命令新建超级用户。但是，这个超级用户没有注册到自己建立的 `User` 模型中，因此不能登录前端页面。

## 测试过程

项目的测试与开发几乎并行，编写完一部分测试一部分。开始采用的是**白盒测试**方法，通过**条件/分支覆盖**测试程序逻辑。采用**自下而上的集成方式**，测试完各个模块后一起测试整个项目。最后上线前采用**黑盒测试**方法，模拟实际运行时项目的表现。

## 维护过程

**改正性维护**是开发过程中使用最多的维护活动。项目不能正常运行时使用此类维护。

**适应性维护**是修改软件架构或开发新功能时经常进行的维护活动。新功能要整合进原有的软件中，常常需要修改架构以便新旧功能能一起运行。

**完善性维护**也是有时需要进行的维护活动。尽管软件运行没有出现错误，但常常发现一项功能新的更便捷的实现方式，也会修改软件采用另一种实现方式。

**预防性维护**是偶尔进行的维护活动。